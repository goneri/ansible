# Test code for the vmware_host_dns module.
# Copyright: (c) 2019, Mario Lenz <m@riolenz.de>
# GNU General Public License v3.0+ (see COPYING or https://www.gnu.org/licenses/gpl-3.0.txt)

- import_role:
    name: prepare_vmware_tests
  vars:
    setup_esxi_instance: true

- name: Gather DNS facts about ESXi Host
  vmware_host_dns_info:
    hostname: '{{ esxi1 }}'
    username: '{{ esxi1_username }}'
    password: '{{ esxi1_password }}'
    esxi_hostname: "{{ esxi1 }}"
    validate_certs: False
  register: res
- set_fact:
    # with govcsim, {{ esxi1 }} and the esxi1 FQDN are different
    #   esxi1 vs localhost.localdomain
    esxi_dns_info: "{{ res.hosts_dns_info.values()|list|first }}"
- debug: var=esxi_dns_info
- include_tasks: dhcp.yml
  when: esxi_dns_info.dhcp
- include_tasks: static.yml
  when: not esxi_dns_info.dhcp
